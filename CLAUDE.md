# ORAPA SPACE - 개발 가이드

## 현재 버전
**Version: 1.6.0** (2025-12-24)

---

## 버전 히스토리

### v1.6.0 (2025-12-24)
- 🕳️ **블랙홀 굴절 로직 완전 재작성** (중요 수정)
  - 블랙홀 감지 범위: 4방향 → 8방향(대각선 포함)
  - 굴절 방향 로직 개선: 현재 방향과 수직으로 90도, 블랙홀에 가까워지는 방향으로 굴절
  - 블랙홀 직접 맞으면 소멸, 옆 칸 지나가면 90도 굴절 (1회 한정)
  - 무한 루프 감지 (trapped) 기능 유지
  - 콘솔 디버그 로그 개선: 블랙홀 위치, 굴절 전후 방향 표시

### v1.5.1 (2025-12-24)
- 디버그 전체 레이저 테스트에 블랙홀 상태 표시 추가
  - 'disappeared' (소멸), 'trapped' (포획) 상태 표시
  - 레이저 발사 기록과 동일한 형식으로 표시
- 블랙홀 굴절 디버그 로그 추가 (콘솔에서 확인 가능)

### v1.5.0 (2025-12-24)
- 🔄 **캐싱 문제 해결**: script.js에 버전 쿼리 파라미터 추가 (F5만 눌러도 업데이트 반영)
- 행성 배치 검증 로직 개선
  - 연습 모드: 블랙홀 포함 7개 행성 검증
  - 다른 모드: 블랙홀 제외 6개 행성 검증
  - 동적으로 메시지 표시 (예: "7개의 서로 다른 행성을 각각 1개씩 배치해야 합니다")

### v1.4.3 (2025-12-24)
- 디버깅: 연습 모드 블랙홀 배치 로그 추가
- 게임 모드 및 배치되는 행성 타입 콘솔 출력

### v1.4.2 (2025-12-24)
- 하드 모드 블랙홀 개수 수정: 정확히 1개만 배치 (기존 1-2개 랜덤에서 변경)

### v1.4.1 (2025-12-24)
- 연습 모드 랜덤 배치에 블랙홀 포함
- 블랙홀 배치 시 gameState.blackHoles 배열에 위치 기록

### v1.4.0 (2025-12-24)
- 🕳️ **블랙홀 시스템 추가** (하드 모드 핵심 메카닉)
  - 싱글 플레이 3가지 모드: 쉬움, 어려움(블랙홀), 연습 모드
  - 기본 모드를 "싱글 어려움(블랙홀)"로 변경
  - 하드 모드에서 블랙홀 1개 배치
  - 연습 모드에도 블랙홀 배치 가능 (테스트용)
- **블랙홀 메카닉**:
  - 직접 맞으면: 레이저 소멸 (disappeared)
  - 옆 칸 지나면: 블랙홀 방향으로 90도 굴절 (한 번만)
  - 무한 루프: 레이저 포획 (trapped)
- 좌표 질문으로 블랙홀 확인 가능 ("블랙홀이 있습니다 🕳️")
- 레이저 히스토리에 블랙홀 상태 표시

### v1.3.1 (2025-12-24)
- 좌표 질문 패널 UI/UX 개선
- 레이저 발사 기록과 AI 문제 보드 사이로 위치 이동
- 행/열 선택 버튼 크기 확대 (가로 폭 증가)
- 선택된 버튼 시각적 표시 강화 (파란색 배경 + 노란색 테두리 + 글로우 효과)
- 모바일 반응형 스타일 추가

### v1.3.0 (2025-12-24)
- 좌표 질문 기능 추가 (36가지 레이저 발사 외 직접 좌표 질문 가능)
- 행(A-G) 및 열(1-11) 선택 UI 추가
- 특정 격자 칸의 내용물 질문 가능 ("4행 3열에는 무엇이 있습니까?")
- 행성 색상별 답변 제공 ("빨간 행성이 있습니다" / "아무것도 없습니다")
- 좌표 질문도 시도 횟수에 포함 및 히스토리 기록

### v1.2.1 (2025-12-24)
- 행성 제거 로직 개선 (원점이 아닌 모든 셀 클릭 시에도 제거 가능)
- 다칸 행성(9칸, 4칸, 2칸 등)의 모든 부분 클릭 시 제거 확인창 표시
- 질문자 보드와 탐험가 보드 모두 적용

### v1.2.0 (2025-12-24)
- 탐험가 보드에서 행성 교체 기능 추가 (기존 행성 제거 후 재배치)
- 게임 시작 전 메시지 개선 ('게임 시작 버튼을 눌러주세요')
- 이미 배치된 행성 교체 시 확인 다이얼로그 추가

### v1.1.0 (2025-12-24)
- 행성 선택 토글 기능 추가 (같은 행성 재클릭 시 선택 해제)
- 행성 패널 바깥 영역 클릭 시 선택 해제 기능
- 싱글 플레이 모드 초기 로드 시 버튼 자동 숨김 개선
- .gitignore 수정 (rule/ 폴더 제외)

### v1.0.0 (2025-12-23)
- 싱글 플레이 모드 추가
- AI 문제 보드 물음표로 가리기 기능
- 포기하기 버튼 추가
- 게임 종료 모달창 및 다시하기 버튼 구현
- 시도 횟수 시스템 개선 (레이저 발사 + 솔루션 제출)
- 솔루션 제출 실패 시 게임 계속 진행
- 모바일 스크롤 최적화
- 게임 시작 버튼 추가

### v0.9.0 (이전 버전)
- 연습 모드
- 2인 대전 모드
- 기본 게임 메커니즘

---

## 프로젝트 구조

```
orapa-space/
├── index.html          # 메인 HTML 파일
├── script.js           # 게임 로직 (2500+ 줄)
├── style.css           # 스타일시트
└── CLAUDE.md          # 이 파일 (개발 가이드)
```

---

## 게임 모드

### 1. 싱글 플레이 (기본 모드)
- 자동으로 랜덤 문제 생성
- AI 문제 보드가 물음표로 가려짐
- 포기하기 버튼 제공
- 디버그 패널 숨김
- 모달창으로 게임 종료 및 다시하기

### 2. 연습 모드
- 수동으로 행성 배치
- 랜덤 배치, 초기화, 배치 완료 버튼 제공
- 디버그 패널 표시
- 기존 기능 그대로 유지

---

## 주요 게임 상태 (gameState)

```javascript
{
    phase: 'setup' | 'playing' | 'finished',
    mode: 'singlePlay' | 'practice',
    selectedPlanet: null | string,
    selectedPosition: null | number | string,
    planetRotations: { 'medium-jupiter': 0-270, 'large-saturn': 0-270 },
    pendingPlacement: null | object,
    laserCount: number,  // 시도 횟수
    explorerBoard: Array[7][11],
    questionerBoard: Array[7][11],
    laserHistory: Array,
    questionerBoardHidden: boolean  // 싱글 플레이에서 정답 숨김
}
```

---

## 핵심 함수

### 게임 초기화
- `initGame()` - 게임 전체 초기화
- `initializeBoards()` - 보드 생성
- `restartGame()` - 게임 재시작

### 게임 플레이
- `randomPlacement()` - 랜덤 행성 배치
- `confirmSetup()` - 배치 완료
- `submitSolution()` - 솔루션 제출
- `giveUp()` - 포기하기
- `fireLaserFromButton()` - 레이저 발사

### UI 관리
- `updateGameModeUI()` - 모드별 UI 업데이트
- `renderBoard(boardId)` - 보드 렌더링
- `updateGameVersion()` - 버전 정보 업데이트

---

## 행성 타입 (PLANETS)

1. **small-red** - 작은 빨강 (1x1, 원형)
2. **small-orange** - 중간 빨강 (2x2, 마름모)
3. **small-blue** - 중간 파랑 (2x2, 마름모)
4. **medium-earth** - 중간 노랑 (3x3, 팔각형)
5. **medium-jupiter** - 큰 흰색 (4x2, 사다리꼴, 회전 가능)
6. **large-saturn** - 큰 링 흰색 (4x2, 링, 회전 가능)

---

## 버전 업데이트 방법

### 1. CLAUDE.md 파일 업데이트
- 버전 번호 변경 (상단 "현재 버전")
- 버전 히스토리에 새 버전 추가
- 주요 변경사항 기록

### 2. script.js에서 버전 업데이트
```javascript
const GAME_VERSION = "1.5.0";  // 이 값을 변경
```

### 3. index.html에서 캐시 버스팅 버전 업데이트
```html
<script src="script.js?v=1.5.0"></script>  <!-- 쿼리 파라미터 버전 변경 -->
```
- **중요**: F5만 눌러도 업데이트를 확인할 수 있도록 버전 파라미터 필수!
- Ctrl+Shift+F5 없이도 최신 코드 로드 가능

### 4. 자동 반영
- `updateGameVersion()` 함수가 자동으로 우측 상단 버전 표시 업데이트

### 5. ⚠️ **중요: GitHub Pages에 반영**
- **모든 수정 후 반드시 git push 필수!**
- GitHub Pages는 push해야만 업데이트됨
- 로컬 수정만으로는 https://wjdtjq1121.github.io/orapa-space/ 에 반영 안 됨

```bash
git add .
git commit -m "feat: 변경사항 설명"
git push
```

---

## 알려진 이슈 및 해결 방법

### 이슈 1: 초기 로드 시 정답 보임
**해결**:
- `gameState.questionerBoardHidden = true`를 보드 초기화 전에 설정
- `requestAnimationFrame` 사용으로 렌더링 순서 보장

### 이슈 2: 모바일 스크롤 버벅임
**해결**:
- resize 이벤트에서 너비만 체크 (세로 변경 무시)
- debounce 시간 500ms로 증가
- 10px 미만 변경 무시

### 이슈 3: 솔루션 제출 실패 시 게임 종료
**해결**:
- 실패 시 게임 종료하지 않고 계속 진행
- 시도 횟수만 증가
- 1.5초 메시지 표시 후 자동 제거

---

## 개발 팁

### 디버깅
- 연습 모드에서 디버그 패널 확인
- `displayPlanetDebugInfo()` - 행성 배치 정보
- `displayAllLaserTests()` - 전체 레이저 테스트 (36가지)

### 모바일 테스트
- Chrome DevTools 모바일 에뮬레이터 사용
- 실제 기기에서 스크롤 및 터치 테스트 필수

### 성능 최적화
- `requestAnimationFrame` 사용
- debounce/throttle 적용
- 불필요한 리렌더링 방지

---

## Git 커밋 메시지 규칙

```
<type>: <subject>

<body>

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

**Type 예시:**
- feat: 새로운 기능
- fix: 버그 수정
- refactor: 리팩토링
- perf: 성능 개선
- docs: 문서 수정

---

## 연락처 및 리소스

- GitHub: https://github.com/wjdtjq1121/orapa-space
- Live Demo: https://wjdtjq1121.github.io/orapa-space/

---

## TODO (향후 개선 사항)

- [ ] 난이도 선택 기능
- [ ] 힌트 시스템
- [ ] 사운드 효과
- [ ] 리더보드
- [ ] 문제 공유 기능
- [ ] 다크 모드
